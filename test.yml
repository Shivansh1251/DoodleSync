config:
  target: 'http://localhost:4000'  # Your DoodleSync backend server
  phases:
    - duration: 30
      arrivalRate: 5
    - duration: 60
      arrivalRate: 10
    - duration: 30
      arrivalRate: 3
  defaults:
    headers:
      'Content-Type': 'application/json'
  socketio:
    reconnection: true
    reconnectionDelay: 1000

scenarios:
  - name: "Whiteboard Room Load Test"
    weight: 60
    engine: socketio
    flow:
      # Connect to socket and join a room
      - emit:
          channel: "join-room"
          data: 
            - "test-room-1"
            - { id: "user-123", name: "TestUser" }
      
      # Wait for doc-init
      - think: 2
      
      # Send drawing updates (simulate whiteboard drawing)
      - emit:
          channel: "doc-update"
          data:
            - "test-room-1"
            - { 
                shapes: [
                  {
                    id: "shape-1",
                    type: "draw",
                    x: 100,
                    y: 200,
                    props: { size: "m", color: "black" }
                  }
                ]
              }
      - think: 1
      - emit:
          channel: "doc-update"
          data:
            - "test-room-1"
            - { 
                shapes: [
                  {
                    id: "shape-2",
                    type: "draw",
                    x: 300,
                    y: 400,
                    props: { size: "m", color: "red" }
                  }
                ]
              }
      - think: 1
      
      # Send chat messages
      - emit:
          channel: "chat-message"
          data:
            - "test-room-1"
            - {
                author: { id: "user-123", name: "TestUser" },
                text: "Hello from load test!",
                ts: 1234567890
              }
      
      # Wait and save room
      - think: 3
      - emit:
          channel: "save-room"
          data: ["test-room-1"]

  - name: "Multiple Room Simulation"
    weight: 40
    engine: socketio
    flow:
      # Simulate users joining different room types
      - emit:
          channel: "join-room"
          data: 
            - "public-12345"
            - { id: "user-456", name: "MultiUser" }
      
      - think: 1
      
      # Multiple drawing updates (stress test)
      - emit:
          channel: "doc-update"
          data:
            - "public-12345"
            - {
                shapes: [
                  {
                    id: "rapid-shape-1",
                    type: "geo",
                    x: 150,
                    y: 250
                  }
                ],
                bindings: [],
                assets: []
              }
      - think: 0.5
      - emit:
          channel: "doc-update"
          data:
            - "public-12345"
            - {
                shapes: [
                  {
                    id: "rapid-shape-2",
                    type: "geo", 
                    x: 350,
                    y: 450
                  }
                ],
                bindings: [],
                assets: []
              }